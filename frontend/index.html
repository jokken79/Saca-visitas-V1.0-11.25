<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNS Visa Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="theme.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="ui-shell.js" defer></script>
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; }
    </style>
</head>
<body class="app-body">
    <main class="page-container">
        <!-- Header -->
        <header class="glass-panel p-10 text-center mb-12">
            <div class="inline-flex items-center gap-4 mb-6">
                <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-2xl shadow-blue-500/30">
                    <span class="text-4xl">ğŸ‡¯ğŸ‡µ</span>
                </div>
            </div>
            <div class="flex flex-col items-center gap-2">
                <div class="badge-soft">ç²¾å¯†ç®¡ç† / è‡ªå‹•è­¦å‘Š</div>
                <h1 class="text-4xl md:text-5xl font-bold text-white">UNS Visa Management System</h1>
                <p class="text-lg text-blue-100">æ´¾é£ä¼šç¤¾å‘ã‘ãƒ“ã‚¶ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
                <p class="text-slate-300">æŠ€è¡“ãƒ»äººæ–‡çŸ¥è­˜ãƒ»å›½éš›æ¥­å‹™ | åœ¨ç•™æœŸé–“æ›´æ–°ãƒ»èªå®šãƒ»å¤‰æ›´</p>
            </div>
        </header>

        <!-- Quick Stats -->
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold text-white flex items-center gap-2">
                <i data-lucide="activity" class="w-5 h-5 text-blue-300"></i>
                <span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æŒ‡æ¨™</span>
            </h2>
            <span id="data-mode" class="badge-soft hidden"></span>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-10">
            <div class="glass-panel p-5 text-center">
                <div class="flex justify-center mb-2"><i data-lucide="users" class="text-blue-300"></i></div>
                <div class="text-3xl font-bold text-white" id="stat-employees">--</div>
                <div class="text-sm text-slate-300">å¾“æ¥­å“¡æ•°</div>
            </div>
            <div class="glass-panel p-5 text-center">
                <div class="flex justify-center mb-2"><i data-lucide="bell" class="text-yellow-300"></i></div>
                <div class="text-3xl font-bold text-yellow-400" id="stat-expiring">--</div>
                <div class="text-sm text-slate-300">æœŸé™90æ—¥ä»¥å†…</div>
            </div>
            <div class="glass-panel p-5 text-center">
                <div class="flex justify-center mb-2"><i data-lucide="alert-triangle" class="text-red-300"></i></div>
                <div class="text-3xl font-bold text-red-400" id="stat-critical">--</div>
                <div class="text-sm text-slate-300">æœŸé™30æ—¥ä»¥å†…</div>
            </div>
            <div class="glass-panel p-5 text-center">
                <div class="flex justify-center mb-2"><i data-lucide="clock-3" class="text-emerald-300"></i></div>
                <div class="text-3xl font-bold text-green-400" id="stat-pending">--</div>
                <div class="text-sm text-slate-300">ç”³è«‹ä¸­</div>
            </div>
        </div>

        <!-- Main Actions -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
            <!-- OCR Scanner -->
            <a href="ocr-scanner.html" class="group bg-gradient-to-br from-blue-600 to-blue-700 rounded-2xl p-6 hover:from-blue-500 hover:to-blue-600 transition-all shadow-xl hover:shadow-2xl hover:shadow-blue-500/30">
                <div class="text-4xl mb-4"><i data-lucide="scan" class="w-8 h-8"></i></div>
                <h3 class="text-xl font-bold text-white mb-2">OCRè‡ªå‹•èª­å–</h3>
                <p class="text-blue-100 text-sm">åœ¨ç•™ã‚«ãƒ¼ãƒ‰ãƒ»ãƒ‘ã‚¹ãƒãƒ¼ãƒˆã‚’è‡ªå‹•èª­ã¿å–ã‚Š</p>
                <div class="mt-4 text-blue-200 group-hover:text-white transition-colors">
                    é–‹å§‹ã™ã‚‹ â†’
                </div>
            </a>

            <!-- Renewal Form -->
            <a href="visa-renewal.html" class="group bg-gradient-to-br from-green-600 to-green-700 rounded-2xl p-6 hover:from-green-500 hover:to-green-600 transition-all shadow-xl hover:shadow-2xl hover:shadow-green-500/30">
                <div class="text-4xl mb-4"><i data-lucide="refresh-ccw" class="w-8 h-8"></i></div>
                <h3 class="text-xl font-bold text-white mb-2">æ›´æ–°ç”³è«‹æ›¸</h3>
                <p class="text-green-100 text-sm">åœ¨ç•™æœŸé–“æ›´æ–°è¨±å¯ç”³è«‹æ›¸ã‚’ä½œæˆ</p>
                <div class="mt-4 text-green-200 group-hover:text-white transition-colors">
                    ä½œæˆã™ã‚‹ â†’
                </div>
            </a>

            <!-- COE Form -->
            <a href="visa-coe.html" class="group bg-gradient-to-br from-purple-600 to-purple-700 rounded-2xl p-6 hover:from-purple-500 hover:to-purple-600 transition-all shadow-xl hover:shadow-2xl hover:shadow-purple-500/30">
                <div class="text-4xl mb-4"><i data-lucide="file-badge" class="w-8 h-8"></i></div>
                <h3 class="text-xl font-bold text-white mb-2">èªå®šç”³è«‹æ›¸</h3>
                <p class="text-purple-100 text-sm">åœ¨ç•™è³‡æ ¼èªå®šè¨¼æ˜æ›¸äº¤ä»˜ç”³è«‹æ›¸</p>
                <div class="mt-4 text-purple-200 group-hover:text-white transition-colors">
                    ä½œæˆã™ã‚‹ â†’
                </div>
            </a>

            <!-- Employee List -->
            <a href="employees.html" class="group bg-gradient-to-br from-slate-600 to-slate-700 rounded-2xl p-6 hover:from-slate-500 hover:to-slate-600 transition-all shadow-xl">
                <div class="text-4xl mb-4"><i data-lucide="users" class="w-8 h-8"></i></div>
                <h3 class="text-xl font-bold text-white mb-2">å¾“æ¥­å“¡ç®¡ç†</h3>
                <p class="text-slate-300 text-sm">å¾“æ¥­å“¡ä¸€è¦§ãƒ»ç™»éŒ²ãƒ»ç·¨é›†</p>
                <div class="mt-4 text-slate-300 group-hover:text-white transition-colors">
                    è¡¨ç¤ºã™ã‚‹ â†’
                </div>
            </a>

            <!-- Company Management -->
            <a href="haken-saki.html" class="group bg-gradient-to-br from-orange-600 to-orange-700 rounded-2xl p-6 hover:from-orange-500 hover:to-orange-600 transition-all shadow-xl">
                <div class="text-4xl mb-4"><i data-lucide="factory" class="w-8 h-8"></i></div>
                <h3 class="text-xl font-bold text-white mb-2">æ´¾é£å…ˆç®¡ç†</h3>
                <p class="text-orange-100 text-sm">æ´¾é£å…ˆä¼šç¤¾ã®ç™»éŒ²ãƒ»ç®¡ç†</p>
                <div class="mt-4 text-orange-200 group-hover:text-white transition-colors">
                    ç®¡ç†ã™ã‚‹ â†’
                </div>
            </a>

            <!-- Reports -->
            <a href="reports.html" class="group bg-gradient-to-br from-cyan-600 to-cyan-700 rounded-2xl p-6 hover:from-cyan-500 hover:to-cyan-600 transition-all shadow-xl">
                <div class="text-4xl mb-4"><i data-lucide="bar-chart-3" class="w-8 h-8"></i></div>
                <h3 class="text-xl font-bold text-white mb-2">ãƒ¬ãƒãƒ¼ãƒˆ</h3>
                <p class="text-cyan-100 text-sm">æœŸé™ç®¡ç†ãƒ»çµ±è¨ˆãƒ¬ãƒãƒ¼ãƒˆ</p>
                <div class="mt-4 text-cyan-200 group-hover:text-white transition-colors">
                    è¡¨ç¤ºã™ã‚‹ â†’
                </div>
            </a>

            <!-- Data Import -->
            <a href="import.html" class="group bg-gradient-to-br from-pink-600 to-pink-700 rounded-2xl p-6 hover:from-pink-500 hover:to-pink-600 transition-all shadow-xl">
                <div class="text-4xl mb-4"><i data-lucide="upload-cloud" class="w-8 h-8"></i></div>
                <h3 class="text-xl font-bold text-white mb-2">ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h3>
                <p class="text-pink-100 text-sm">æ´¾é£å…ˆ(JSON)ãƒ»å¾“æ¥­å“¡(Excel)ã‚’ä¸€æ‹¬ç™»éŒ²</p>
                <div class="mt-4 text-pink-200 group-hover:text-white transition-colors">
                    ã‚¤ãƒ³ãƒãƒ¼ãƒˆ â†’
                </div>
            </a>
        </div>

        <!-- System Services -->
        <div class="glass-panel p-6 mb-12">
            <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2"><i data-lucide="server-cog"></i><span>ã‚·ã‚¹ãƒ†ãƒ ã‚µãƒ¼ãƒ“ã‚¹</span></h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-slate-800/50 rounded-lg p-4 border border-white/5">
                    <div class="text-sm text-slate-400 mb-1">API Server</div>
                    <div class="flex items-center gap-2">
                        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                        <a href="/docs" class="text-white hover:text-blue-400">localhost:8100</a>
                    </div>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-4 border border-white/5">
                    <div class="text-sm text-slate-400 mb-1">Database</div>
                    <div class="flex items-center gap-2">
                        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                        <span class="text-white">PostgreSQL:5433</span>
                    </div>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-4 border border-white/5">
                    <div class="text-sm text-slate-400 mb-1">DB Admin</div>
                    <div class="flex items-center gap-2">
                        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                        <a href="http://localhost:8181" target="_blank" class="text-white hover:text-blue-400">Adminer:8181</a>
                    </div>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-4 border border-white/5">
                    <div class="text-sm text-slate-400 mb-1">Cache</div>
                    <div class="flex items-center gap-2">
                        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                        <span class="text-white">Redis:6380</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alerts Section -->
        <div class="bg-red-900/30 border border-red-500/30 rounded-2xl p-6 mb-12" id="alerts-section" style="display: none;">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-red-400 flex items-center gap-2">
                    <i data-lucide="alert-octagon"></i> æœŸé™é–“è¿‘ã®å¾“æ¥­å“¡
                </h2>
                <span id="alerts-mode" class="badge-soft hidden text-xs"></span>
            </div>
            <div id="alerts-list" class="space-y-2">
                <!-- Alerts will be loaded here -->
            </div>
        </div>

    </main>

    <script>
        const dataModeBadge = document.getElementById('data-mode');
        const alertsModeBadge = document.getElementById('alerts-mode');

        const demoStats = {
            total_employees: 128,
            expiring_90_days: 7,
            expiring_30_days: 3,
            pending_applications: 4
        };

        const demoAlerts = [
            { family_name: 'ä½è—¤', given_name: 'å¤ªéƒ', nationality: 'JPN', days_remaining: 18 },
            { family_name: 'Nguyen', given_name: 'Thao', nationality: 'VNM', days_remaining: 24 },
            { family_name: 'Chen', given_name: 'Wei', nationality: 'TWN', days_remaining: 27 }
        ];

        function setBadgeMode(badge, label, tone = 'info') {
            if (!badge) return;
            const toneClasses = {
                success: 'bg-emerald-500/20 text-emerald-100 border-emerald-400/30',
                warning: 'bg-amber-500/20 text-amber-100 border-amber-400/30',
                info: 'bg-blue-500/20 text-blue-100 border-blue-400/30'
            };
            badge.className = `badge-soft ${toneClasses[tone] || ''}`;
            badge.textContent = label;
            badge.classList.remove('hidden');
        }

        function renderStats(data, isDemo = false) {
            document.getElementById('stat-employees').textContent = data.total_employees ?? '--';
            document.getElementById('stat-expiring').textContent = data.expiring_90_days ?? '--';
            document.getElementById('stat-critical').textContent = data.expiring_30_days ?? '--';
            document.getElementById('stat-pending').textContent = data.pending_applications ?? '--';
            setBadgeMode(dataModeBadge, isDemo ? 'ãƒ‡ãƒ¢è¡¨ç¤º (APIæœªæ¥ç¶š)' : 'APIé€£æº: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ', isDemo ? 'warning' : 'success');
        }

        function renderAlerts(alerts = [], isDemo = false) {
            const alertsSection = document.getElementById('alerts-section');
            const alertsList = document.getElementById('alerts-list');
            if (!alerts || alerts.length === 0) {
                alertsSection.style.display = 'none';
                alertsModeBadge.classList.add('hidden');
                return;
            }

            alertsSection.style.display = 'block';
            setBadgeMode(alertsModeBadge, isDemo ? 'ãƒ‡ãƒ¢ã‚µãƒ³ãƒ—ãƒ«' : 'APIã‹ã‚‰å–å¾—', isDemo ? 'warning' : 'success');
            alertsList.innerHTML = alerts.slice(0, 5).map(alert => `
                <div class="bg-red-950/50 rounded-lg p-3 flex justify-between items-center">
                    <div>
                        <span class="text-white font-medium">${alert.family_name} ${alert.given_name}</span>
                        <span class="text-red-300 text-sm ml-2">(${alert.nationality})</span>
                    </div>
                    <div class="text-red-400 font-bold">
                        æ®‹ã‚Š${alert.days_remaining}æ—¥
                    </div>
                </div>
            `).join('');
        }

        // Load stats from API
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                if (response.ok) {
                    const data = await response.json();
                    renderStats(data, false);
                    return;
                }
            } catch (e) {
                console.log('API not available yet');
            }
            renderStats(demoStats, true);
        }

        // Load alerts
        async function loadAlerts() {
            try {
                const response = await fetch('/api/alerts/expiring?days=30');
                if (response.ok) {
                    const data = await response.json();
                    renderAlerts(data.alerts || [], false);
                    return;
                }
            } catch (e) {
                console.log('Alerts API not available');
            }
            renderAlerts(demoAlerts, true);
        }

        // Load on page load
        document.addEventListener('DOMContentLoaded', () => {
            renderAppShell({ active: 'dashboard', headline: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', subtitle: 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±è¨ˆã¨ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ' });
            loadStats();
            loadAlerts();
            if (window.lucide && typeof window.lucide.createIcons === 'function') {
                window.lucide.createIcons();
            }
            renderFooter();
        });
    </script>
</body>
</html>
